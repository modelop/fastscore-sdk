---
title: "Fastscore R-SDK Example 3"
output: html_notebook
---
install dependencies for Fastscore R-SDK, if necessary
install.packages(c("curl", "jsonlite", "mime", "openssl", "R6", "yaml", "httr", "rjson"))

Things that need to be customized as you go through:
1. proxy_prefix for connection
2. engine name of the engine using
3. library path for local file upload (mode/schema/stream/attachment)
4. If running file-input-stream example, then need to change input/output stream description file path (check /library/streams/), and also put corresponding json files (in /data/) into engine.

Check fastscore.pdf for more detail information of this package

Setup, connect to fleet
```{r}
library(fastscore)
connect <- Connect(proxy_prefix="enter-your-proxy", insecure = TRUE)  # connect to a Fastscore fleet

# setup Fastscore configuration separately
```
Define instance objects
```{r}
connect$fleet()  # take a look at the fleet
engine <- connect$get(name = "engine-1")  # define engine object we are going to use, change engine name if necessary
mm <- connect$get(name = "model-manage-1")  # define model-manage object
```
Define load model information
```{r}
# load model from local directory, naming should including extensions for model language tyle
mm$model_load_from_file(name = "extract.R", path = "./library/models/")  

# load schema from local directory, without extensions since schema should always be .avsc format
# also schema name should match with the smart comments at the beginning of model script
mm$schema_load_from_file(name = "cpi", path = "./library/schemas/")
mm$schema_load_from_file(name = "close", path = "./library/schemas/")
mm$schema_load_from_file(name = "double", path = "./library/schemas/")
mm$schema_load_from_file(name = "adjustment", path = "./library/schemas/")  

# load stream from local directory, without extensions since schema should always be .json format
# input stream. These are inputs from file, make sure file is loaded into engine/container with porper path set in stream description
# these inputs are looping streams, make sure the stop the engine otherwise it is constantly writing to output file
mm$stream_load_from_file(name = "input_cpi", path = "./library/streams/")
mm$stream_load_from_file(name = "input_closing", path = "./library/streams/")
# output stream. These are outputs written to file, the resulting file with be saved in the engine with path descripted in output stream description

mm$stream_load_from_file(name = "double-output", path = "./library/streams/")
mm$stream_load_from_file(name = "adjustment-output", path = "./library/streams/")
```
Deploy model with file stream (need to copy input file into engine container first)
```{r}
engine$unload_model()  # reset engine for next deployment

engine$input_set(slot = 0, stream = mm$stream_get("input_cpi"))  # set input stream, use even slot numbers 0, 2, 4, etc.
engine$input_set(slot = 2, stream = mm$stream_get("input_closing"))

engine$output_set(slot = 1, stream = mm$stream_get("double-output"))  # set output stream, use odd slot numbers 1, 3, 5, etc.
engine$output_set(slot = 3, stream = mm$stream_get("adjustment-output")) 
engine$output_set(slot = 5, stream = mm$stream_get("double-output")) 

engine$load_model(mm$model_get("extract.R"))  # load model into engine
Sys.sleep(3)  # only let the model run for 3 seconds
engine$unload_model()
```

